{"version":3,"sources":["ChartData.ts","shared/BirthdayPicker.tsx","shared/MainLayout.tsx","Spotify.ts","Home.tsx","SpotifyLoggedIn.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["NoDataReason","useChartData","useState","chartData","setChartData","useEffect","a","fetch","then","response","json","incomingEntries","map","entry","firstWeekEndDate","DateTime","fromISO","first_week_ending_date","title","artist","weeksAtNumberOne","Number","weeks_at_number_one","data","fetchData","findBirthdayNumberOnes","birthdayDate","Interval","fromDateTimes","fromJSDate","local","splitBy","years","interval","findBirthdayNumberOne","start","birthday","chartEntryBeforeBirthday","findLast","minus","days","undefined","date","numberOne","reason","DATE_TOO_OLD","length","plus","weeks","NO_DATA_YET","SubmitButton","styled","button","Container","div","BirthdayPicker","props","selectedDate","Date","setBirthdayDate","selected","onChange","dateFormat","minDate","maxDate","showMonthDropdown","showYearDropdown","dropdownMode","disabled","onClick","onDateSelect","CenteredContainer","PaddedCenteredContainer","MainLayout","children","SpotifyAuthUrl","state","callbackUrl","window","location","origin","SpotifySearchUrl","URL","searchTrack","accessToken","firstArtist","split","queryParameters","URLSearchParams","q","type","limit","toString","headers","Authorization","tracks","items","NumberOnesList","birthdayNumberOnes","birthdayEntry","Result","key","toLocaleString","Home","setSelectedDate","href","toISOString","ErrorDisplay","error","message","NumberOnesDisplay","callbackParams","spotifyData","token","setSpotifyData","entries","Promise","resolve","spotifyTrack","track","all","useSpotifyData","numberOnes","TrackSpotifyDetails","SpotifyTrackInfo","src","album","images","find","img","height","url","alt","name","artists","join","CouldNotFindTrack","useSpotifyHashParams","urlParams","useLocation","pathname","slice","errorParam","get","Error","expiresIn","SpotifyLoggedIn","hashParams","App","path","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","console"],"mappings":"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","file":"static/js/main.34f99cfa.chunk.js","sourcesContent":["import { findLast } from \"lodash\";\nimport { DateTime, Interval } from \"luxon\";\nimport { useState, useEffect } from \"react\";\n\nconst JsonBinUrl = \"https://api.jsonbin.io/b/5ecfe1657741ef56a5638007/latest\";\n\ntype IncomingChartEntry = {\n  first_week_ending_date: string;\n  title: string;\n  artist: string;\n  weeks_at_number_one: string;\n};\n\nexport interface ChartEntry {\n  firstWeekEndDate: DateTime;\n  title: string;\n  artist: string;\n  weeksAtNumberOne: number;\n}\n\nexport type ChartData = Array<ChartEntry>;\n\nexport const getChartData: () => Promise<ChartData> = () =>\n  fetch(JsonBinUrl)\n    .then((response) => response.json())\n    .then((incomingEntries) =>\n      incomingEntries.map((entry: IncomingChartEntry) => ({\n        firstWeekEndDate: DateTime.fromISO(entry.first_week_ending_date),\n        title: entry.title,\n        artist: entry.artist,\n        weeksAtNumberOne: Number(entry.weeks_at_number_one),\n      }))\n    );\n\nexport const useChartData = () => {\n  const [chartData, setChartData] = useState<ChartData | null>(null);\n  useEffect(() => {\n    const fetchData = async () => {\n      const data = await getChartData();\n      setChartData(data);\n    };\n    fetchData();\n  }, []);\n  return chartData;\n};\n\nexport type BirthdayNumberOnes = Array<Birthday>;\n\nexport type Birthday = {\n  date: DateTime;\n  numberOne: ChartEntry | null;\n  reason: NoDataReason | null;\n};\n\nexport enum NoDataReason {\n  NO_DATA_YET,\n  DATE_TOO_OLD,\n}\n\nexport const findBirthdayNumberOnes = (\n  birthdayDate: Date,\n  chartData: ChartData\n): BirthdayNumberOnes =>\n  Interval.fromDateTimes(DateTime.fromJSDate(birthdayDate), DateTime.local())\n    .splitBy({ years: 1 })\n    .map((interval) => findBirthdayNumberOne(interval.start, chartData));\n\nexport const findBirthdayNumberOne = (\n  birthday: DateTime,\n  chartData: ChartData\n): Birthday => {\n  const chartEntryBeforeBirthday = findLast(\n    chartData,\n    (entry) => entry.firstWeekEndDate.minus({ days: 6 }) <= birthday // Date is last day of first week, so subtract 6 days to get beginning\n  );\n  if (chartEntryBeforeBirthday === undefined) {\n    return {\n      date: birthday,\n      numberOne: null,\n      reason: NoDataReason.DATE_TOO_OLD,\n    };\n  } else if (\n    // if entry is final entry\n    chartEntryBeforeBirthday === chartData[chartData.length - 1] &&\n    // and birthday is past chart start plus weeks at number one\n    birthday >=\n      chartEntryBeforeBirthday.firstWeekEndDate.plus({\n        weeks: chartEntryBeforeBirthday.weeksAtNumberOne,\n        days: -6,\n      })\n  ) {\n    return {\n      date: birthday,\n      numberOne: null,\n      reason: NoDataReason.NO_DATA_YET,\n    };\n  } else {\n    return {\n      date: birthday,\n      numberOne: chartEntryBeforeBirthday,\n      reason: null,\n    };\n  }\n};\n","import React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport DatePicker from \"react-datepicker\";\n\ntype Props = {\n  disabled: boolean;\n  onDateSelect: (date: Date) => void;\n  selectedDate?: Date;\n};\n\nconst BirthdayPicker = (props: Props) => {\n  const [birthdayDate, setBirthdayDate] = useState(props.selectedDate ? props.selectedDate : new Date());\n\n  return (\n    <Container>\n      <h3>Enter your birthday below:</h3>\n      <DatePicker\n        selected={birthdayDate}\n        onChange={(date) =>\n          date ? setBirthdayDate(date) : setBirthdayDate(new Date())\n        }\n        dateFormat=\"dd/MM/yyyy\"\n        minDate={new Date(1900, 0, 1)}\n        maxDate={new Date()}\n        showMonthDropdown\n        showYearDropdown\n        dropdownMode=\"select\"\n      />\n      <SubmitButton\n        disabled={props.disabled}\n        onClick={() => props.onDateSelect(birthdayDate)}\n      >\n        Find me a playlist\n      </SubmitButton>\n    </Container>\n  );\n};\n\nconst SubmitButton = styled.button`\n  margin: 10px;\n`;\n\nconst Container = styled.div`\n    display: flex;\n    flex-direction: column;\n    padding: 20px;\n`\n\nexport default BirthdayPicker;\n","import React, { FunctionComponent } from \"react\";\nimport styled from \"styled-components\";\n\nconst MainLayout: FunctionComponent = (props) => (\n  <PaddedCenteredContainer>\n    <h1>Birthday Playlist Generator</h1>\n    <p>\n      Generate a Spotify playlist of UK number ones on your Birthday since you\n      were born. This site is a work in progress.\n    </p>\n    {props.children}\n  </PaddedCenteredContainer>\n);\n\nexport const CenteredContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nexport const PaddedCenteredContainer = styled(CenteredContainer)`\n  padding: 20px;\n`;\n\nexport default MainLayout;\n","import { useEffect, useState } from \"react\";\nimport { Birthday, ChartData, findBirthdayNumberOnes } from \"./ChartData\";\n\nexport const SpotifyAuthUrl = (state: string) => {\n  const callbackUrl = window.location.origin\n  return `https://accounts.spotify.com/authorize?client_id=6c0a042391fa42e8ac96a5eed4306dfe&redirect_uri=${callbackUrl}&scope=playlist-modify-public&response_type=token&state=${state}`;\n}\n\nconst SpotifyApiBaseUrl = \"https://api.spotify.com/v1\";\nconst SpotifySearchUrl = new URL(`${SpotifyApiBaseUrl}/search`);\n\nexport type SpotifyTrack = {\n  album: SpotifyAlbum;\n  artists: Array<SpotifyArtist>;\n  id: string;\n  name: string;\n  uri: string;\n};\n\ntype SpotifyAlbum = {\n  name: string;\n  images: Array<SpotifyAlbumImage>;\n};\n\ntype SpotifyAlbumImage = {\n  height: number;\n  Width: number;\n  url: string;\n};\n\ntype SpotifyArtist = {\n  name: string;\n};\n\nexport type BirthdayWithSpotifyData = {\n  birthday: Birthday;\n  spotifyTrack: SpotifyTrack | null;\n};\n\nconst searchTrack = async (\n  title: string,\n  artist: string,\n  accessToken: string\n): Promise<SpotifyTrack | null> => {\n  const firstArtist = artist.split(/ FT. |\\//)[0];\n  const queryParameters = new URLSearchParams({\n    q: `\"${title}\" \"${firstArtist}\"`,\n    type: \"track\",\n    limit: \"1\",\n  });\n  const response = await fetch(\n    `${SpotifySearchUrl}?${queryParameters.toString()}`,\n    {\n      headers: { Authorization: `Bearer ${accessToken}` },\n    }\n  );\n  const json = await response.json();\n  return json.tracks.items.length > 0 ? json.tracks.items[0] : null;\n};\n\nexport const useSpotifyData = (\n  chartData: ChartData | null,\n  selectedDate: Date,\n  token: string\n) => {\n  const [spotifyData, setSpotifyData] = useState<Array<\n    BirthdayWithSpotifyData\n  > | null>(null);\n\n  useEffect(() => {\n    if (chartData == null) {\n      return;\n    }\n    const birthdayNumberOnes = findBirthdayNumberOnes(selectedDate, chartData);\n    const fetchData = async () => {\n      const entries: Array<Promise<\n        BirthdayWithSpotifyData\n      >> = birthdayNumberOnes.map(async (birthdayEntry) => {\n        if (birthdayEntry.numberOne == null) {\n          return Promise.resolve({\n            birthday: birthdayEntry,\n            spotifyTrack: null,\n          });\n        }\n        const track = await searchTrack(\n          birthdayEntry.numberOne.title,\n          birthdayEntry.numberOne.artist,\n          token\n        );\n        return { birthday: birthdayEntry, spotifyTrack: track };\n      });\n      const data = await Promise.all(entries);\n      setSpotifyData(data);\n    };\n    fetchData();\n  }, [chartData, selectedDate, token]);\n  return spotifyData;\n};\n","import React, { useState } from \"react\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport styled from \"styled-components\";\nimport {\n  BirthdayNumberOnes,\n  findBirthdayNumberOnes,\n  NoDataReason,\n  useChartData,\n} from \"./ChartData\";\nimport BirthdayPicker from \"./shared/BirthdayPicker\";\nimport MainLayout, { CenteredContainer } from \"./shared/MainLayout\";\nimport { SpotifyAuthUrl } from \"./Spotify\";\n\nconst Home = () => {\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const chartData = useChartData();\n  const birthdayNumberOnes =\n    chartData != null && selectedDate != null\n      ? findBirthdayNumberOnes(selectedDate, chartData)\n      : null;\n\n  return (\n    <MainLayout>\n      <BirthdayPicker\n        disabled={chartData == null}\n        onDateSelect={setSelectedDate}\n      />\n      {birthdayNumberOnes && selectedDate && (\n        <CenteredContainer>\n          <a href={SpotifyAuthUrl(selectedDate.toISOString())}>\n            Connect with Spotify for more track information and the option to\n            automatically create a playlist.\n          </a>\n          <NumberOnesList birthdayNumberOnes={birthdayNumberOnes} />\n        </CenteredContainer>\n      )}\n    </MainLayout>\n  );\n};\n\nconst NumberOnesList = (props: { birthdayNumberOnes: BirthdayNumberOnes }) => (\n  <div>\n    {props.birthdayNumberOnes.map((birthdayEntry) => (\n      <Result key={birthdayEntry.date.toLocaleString()}>\n        <h4>{birthdayEntry.date.toLocaleString()}</h4>\n        {birthdayEntry.numberOne ? (\n          <p>\n            {birthdayEntry.numberOne.title} by {birthdayEntry.numberOne.artist}\n          </p>\n        ) : birthdayEntry.reason === NoDataReason.DATE_TOO_OLD ? (\n          <p>UK Charts only started on 08/11/1952</p>\n        ) : (\n          <p>The latest chart data hasn't been updated yet, try again soon!</p>\n        )}\n      </Result>\n    ))}\n  </div>\n);\n\nconst Result = styled.div`\n  text-align: center;\n`;\n\nexport default Home;\n","import React, { useState } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { ChartEntry, NoDataReason, useChartData } from \"./ChartData\";\nimport BirthdayPicker from \"./shared/BirthdayPicker\";\nimport MainLayout, { CenteredContainer } from \"./shared/MainLayout\";\nimport {\n  BirthdayWithSpotifyData,\n  SpotifyAuthUrl,\n  SpotifyTrack,\n  useSpotifyData,\n} from \"./Spotify\";\n\nconst SpotifyLoggedIn = () => {\n  const hashParams = useSpotifyHashParams();\n  return (\n    <MainLayout>\n      {hashParams instanceof Error ? (\n        <ErrorDisplay error={hashParams} />\n      ) : (\n        <NumberOnesDisplay callbackParams={hashParams} />\n      )}\n    </MainLayout>\n  );\n};\n\nconst ErrorDisplay = (props: { error: Error }) => (\n  <CenteredContainer>\n    <h3>Error</h3>\n    <p>An error occurred during authorization with spotify.</p>\n    <a href={SpotifyAuthUrl(new Date().toISOString())}>Click to try again.</a>\n    <p>\n      If this problem persists{\" \"}\n      <a href=\"mailto:playlist@mattmarch.co.uk\">let me know</a>.\n    </p>\n    <p>Error reason: {props.error.message}</p>\n  </CenteredContainer>\n);\n\nconst NumberOnesDisplay = (props: {\n  callbackParams: SuccessCallbackParams;\n}) => {\n  const [selectedDate, setSelectedDate] = useState(\n    new Date(props.callbackParams.state)\n  );\n  const chartData = useChartData();\n  const spotifyData = useSpotifyData(\n    chartData,\n    selectedDate,\n    props.callbackParams.accessToken\n  );\n  return (\n    <CenteredContainer>\n      <p>You are now logged in with Spotify.</p>\n      <p>The ability to generate a playlist is coming soon!</p>\n      <BirthdayPicker\n        selectedDate={selectedDate}\n        disabled={chartData == null}\n        onDateSelect={setSelectedDate}\n      />\n      {spotifyData == null ? (\n        <p>Loading data from Spotify...</p>\n      ) : (\n        <NumberOnesList numberOnes={spotifyData} />\n      )}\n    </CenteredContainer>\n  );\n};\n\nconst NumberOnesList = (props: {\n  numberOnes: Array<BirthdayWithSpotifyData>;\n}) => (\n  <div>\n    {props.numberOnes.map((birthdayEntry) => (\n      <Result key={birthdayEntry.birthday.date.toLocaleString()}>\n        <h4>{birthdayEntry.birthday.date.toLocaleString()}</h4>\n        {birthdayEntry.birthday.numberOne ? (\n          birthdayEntry.spotifyTrack ? (\n            <TrackSpotifyDetails track={birthdayEntry.spotifyTrack} />\n          ) : (\n            <CouldNotFindTrack track={birthdayEntry.birthday.numberOne} />\n          )\n        ) : birthdayEntry.birthday.reason === NoDataReason.DATE_TOO_OLD ? (\n          <p>UK Charts only started on 08/11/1952</p>\n        ) : (\n          <p>The latest chart data hasn't been updated yet, try again soon!</p>\n        )}\n      </Result>\n    ))}\n  </div>\n);\n\nconst Result = styled.div`\n  text-align: center;\n`;\n\nconst TrackSpotifyDetails = (props: { track: SpotifyTrack }) => (\n  <SpotifyTrackInfo>\n    <img\n      src={props.track.album.images.find((img) => img.height === 64)?.url}\n      alt={`${props.track.album.name} cover`}\n    />\n    <p>\n      {props.track.name}<br/>\n      {props.track.artists.map((artist) => artist.name).join(\", \")}\n    </p>\n  </SpotifyTrackInfo>\n);\n\nconst SpotifyTrackInfo = styled.div`\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst CouldNotFindTrack = (props: { track: ChartEntry }) => (\n  <p>\n    Could not find {props.track.title} by {props.track.artist} on Spotify\n  </p>\n);\n\ntype SuccessCallbackParams = {\n  accessToken: string;\n  state: string;\n};\n\nconst useSpotifyHashParams = (): SuccessCallbackParams | Error => {\n  const urlParams = new URLSearchParams(useLocation().pathname.slice(1));\n  const errorParam = urlParams.get(\"error\");\n  if (errorParam != null) {\n    return new Error(`Spotify authorization failed, error was: ${errorParam}`);\n  }\n  const accessToken = urlParams.get(\"access_token\");\n  const expiresIn = Number(urlParams.get(\"expires_in\"));\n  const state = urlParams.get(\"state\");\n  return accessToken != null && expiresIn > 0 && state != null\n    ? {\n        accessToken,\n        state,\n      }\n    : new Error(\"Response from Spotify was missing key return parameters\");\n};\n\nexport default SpotifyLoggedIn;\n","import React from \"react\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { HashRouter, Route, Switch } from \"react-router-dom\";\nimport Home from \"./Home\";\nimport SpotifyLoggedIn from \"./SpotifyLoggedIn\";\n\nconst App = () => (\n  <HashRouter>\n    <Switch>\n      <Route path=\"/:access_token\">\n        <SpotifyLoggedIn/>\n      </Route>\n      <Route path=\"/\">\n        <Home />\n      </Route>\n    </Switch>\n  </HashRouter>\n);\n\nexport default App;\n\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}