{"version":3,"sources":["ChartData.ts","shared/BirthdayPicker.tsx","shared/MainLayout.tsx","Spotify.ts","Home.tsx","SpotifyTrackList.tsx","SpotifyLoggedIn.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["NoDataReason","getChartData","a","fetch","response","json","incomingEntries","map","entry","firstWeekEndDate","DateTime","fromISO","first_week_ending_date","title","artist","weeksAtNumberOne","Number","weeks_at_number_one","useChartData","useState","chartData","setChartData","errorMessage","setErrorMessage","useEffect","data","fetchData","findBirthdayNumberOnes","birthdayDate","Interval","fromDateTimes","fromJSDate","local","splitBy","years","interval","findBirthdayNumberOne","start","birthday","chartEntryBeforeBirthday","findLast","minus","days","undefined","date","numberOne","reason","DATE_TOO_OLD","length","plus","weeks","NO_DATA_YET","CenteredDatePicker","styled","DatePicker","SubmitButton","button","Container","div","BirthdayPicker","props","selectedDate","Date","setBirthdayDate","selected","onChange","dateFormat","minDate","maxDate","showMonthDropdown","showYearDropdown","dropdownMode","disabled","onClick","onDateSelect","CenteredContainer","PaddedCenteredContainer","MainContent","FooterContainer","Footer","href","MainLayout","children","SpotifyAuthUrl","state","callbackUrl","window","location","origin","SpotifySearchUrl","SpotifyProfileUrl","searchTrack","accessToken","firstArtist","split","firstTrack","queryParameters","URLSearchParams","q","type","limit","toString","headers","Authorization","tracks","items","createPlaylist","playlistName","birthdays","token","then","user","playlistDetails","name","description","userId","id","method","body","JSON","stringify","playlist","trackUris","compact","b","spotifyTrack","uri","playlistId","uris","external_urls","spotify","NumberOnesList","birthdayNumberOnes","birthdayEntry","Result","key","toLocaleString","Home","setSelectedDate","toISOString","NumberOnesDisplay","spotifyData","setSpotifyData","entries","Promise","resolve","track","all","message","useSpotifyData","spotifyErrorMessage","onError","numberOnes","SpotifyTrackData","CreatePlaylistDisplay","loading","setLoading","playlistUrl","setPlaylistUrl","onCreatePlaylist","toLocaleDateString","url","TrackList","TrackSpotifyDetails","SpotifyTrackInfo","src","album","images","find","img","height","alt","artists","join","CouldNotFindTrack","ErrorDisplay","error","isSpotifyAuthError","getUrlHashParams","pathname","urlParams","slice","stateParam","get","errorParam","tokenParam","isErrorParams","params","SpotifyLoggedIn","setError","useLocation","isSpotifyError","App","path","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","console"],"mappings":"uGA0DYA,E,6HApCCC,EAAsC,uCAAG,8BAAAC,EAAA,sEAC7BC,MAnBN,4DAkBmC,cAC9CC,EAD8C,gBAEtBA,EAASC,OAFa,cAE9CC,EAF8C,yBAG7CA,EAAgBC,KAAI,SAACC,GAAD,MAAgC,CACzDC,iBAAkBC,WAASC,QAAQH,EAAMI,wBACzCC,MAAOL,EAAMK,MACbC,OAAQN,EAAMM,OACdC,iBAAkBC,OAAOR,EAAMS,0BAPmB,2CAAH,qDAWtCC,EAAe,WAAO,IAAD,EACEC,mBAA2B,MAD7B,mBACzBC,EADyB,KACdC,EADc,OAEQF,mBAAwB,MAFhC,mBAEzBG,EAFyB,KAEXC,EAFW,KAchC,OAXAC,qBAAU,YACO,uCAAG,4BAAAtB,EAAA,+EAEKD,IAFL,OAERwB,EAFQ,OAGdJ,EAAaI,GAHC,gDAKdF,EAAgB,sCALF,yDAAH,qDAQfG,KACC,IACI,CAACN,YAAWE,kB,SAWTtB,O,6BAAAA,I,gCAAAA,M,KAKL,IAAM2B,EAAyB,SACpCC,EACAR,GAFoC,OAIpCS,WAASC,cAAcpB,WAASqB,WAAWH,GAAelB,WAASsB,SAChEC,QAAQ,CAAEC,MAAO,IACjB3B,KAAI,SAAC4B,GAAD,OAAcC,EAAsBD,EAASE,MAAOjB,OAEhDgB,EAAwB,SACnCE,EACAlB,GAEA,IAAMmB,EAA2BC,mBAC/BpB,GACA,SAACZ,GAAD,OAAWA,EAAMC,iBAAiBgC,MAAM,CAAEC,KAAM,KAAQJ,KAE1D,YAAiCK,IAA7BJ,EACK,CACLK,KAAMN,EACNO,UAAW,KACXC,OAAQ9C,EAAa+C,cAIvBR,IAA6BnB,EAAUA,EAAU4B,OAAS,IAE1DV,GACEC,EAAyB9B,iBAAiBwC,KAAK,CAC7CC,MAAOX,EAAyBxB,iBAChC2B,MAAO,IAGJ,CACLE,KAAMN,EACNO,UAAW,KACXC,OAAQ9C,EAAamD,aAGhB,CACLP,KAAMN,EACNO,UAAWN,EACXO,OAAQ,O,6UC9Fd,IA8BMM,EAAqBC,YAAOC,IAAPD,CAAH,KAIlBE,EAAeF,IAAOG,OAAV,KAIZC,EAAYJ,IAAOK,IAAV,KAMAC,EA5CQ,SAACC,GAAkB,IAAD,EACCzC,mBACtCyC,EAAMC,aAAeD,EAAMC,aAAe,IAAIC,MAFT,mBAChClC,EADgC,KAClBmC,EADkB,KAKvC,OACE,kBAACN,EAAD,KACE,0DACA,kBAACL,EAAD,CACEY,SAAUpC,EACVqC,SAAU,SAACrB,GAAD,OACDmB,EAAPnB,GAA+C,IAAIkB,OAErDI,WAAW,aACXC,QAAS,IAAIL,KAAK,KAAM,EAAG,GAC3BM,QAAS,IAAIN,KACbO,mBAAiB,EACjBC,kBAAgB,EAChBC,aAAa,WAEf,kBAAChB,EAAD,CACEiB,SAAUZ,EAAMY,SAChBC,QAAS,kBAAMb,EAAMc,aAAa9C,KAFpC,wB,0aC3BN,IAoBa+C,EAAoBtB,IAAOK,IAAV,KAMjBkB,EAA0BvB,YAAOsB,EAAPtB,CAAH,KAI9BwB,EAAcxB,YAAOsB,EAAPtB,CAAH,KAIXyB,EAAkBzB,IAAOK,IAAV,KAKfqB,EAAS,kBACb,kBAACD,EAAD,KACE,6BACA,wCACS,uBAAGE,KAAK,2BAAR,eAET,uDAC4B,IAC1B,uBAAGA,KAAK,iDAAR,aAKSC,EApDuB,SAACrB,GAAD,OACpC,kBAACgB,EAAD,KACE,2DACA,mJAIA,gEACqC,IACnC,uBAAGI,KAAK,uEAAR,uBAEK,IAJP,mFAQA,kBAACH,EAAD,KAAcjB,EAAMsB,UACpB,kBAAC,EAAD,QCfSC,EAAiB,SAACC,GAC7B,IAAMC,EAAcC,OAAOC,SAASC,OACpC,MAAM,kGAAN,OAAyGH,EAAzG,mEAA+KD,IAI3KK,EAAgB,UADI,6BACJ,WAChBC,EAAiB,UAFG,6BAEH,OAkCjBC,EAAW,uCAAG,WAClB9E,EACAC,EACA8E,GAHkB,uBAAA1F,EAAA,6DAKZ2F,EAAc/E,EAAOgF,MAAM,uCAAuC,GAClEC,EAAalF,EAAMiF,MAAM,KAAK,GAC9BE,EAAkB,IAAIC,gBAAgB,CAC1CC,EAAE,IAAD,OAAMH,EAAN,cAAsBF,EAAtB,KACDM,KAAM,QACNC,MAAO,MAVS,SAYKjG,MAAM,GAAD,OACvBsF,EADuB,YACHO,EAAgBK,YACvC,CACEC,QAAS,CAAEC,cAAc,UAAD,OAAYX,MAftB,cAYZxF,EAZY,gBAkBCA,EAASC,OAlBV,cAkBZA,EAlBY,yBAmBXA,EAAKmG,OAAOC,MAAMzD,OAAS,EAAI3C,EAAKmG,OAAOC,MAAM,GAAK,MAnB3C,4CAAH,0DA6EJC,EAAc,uCAAG,WAC5BC,EACAC,EACAC,GAH4B,qBAAA3G,EAAA,sEAKIC,MAAMuF,EAAmB,CACvDY,QAAS,CAAEC,cAAc,UAAD,OAAYM,MACnCC,MAAK,SAAC1G,GAAD,OAAcA,EAASC,UAPH,cAKtB0G,EALsB,OAQtBC,EAAkB,CACtBC,KAAMN,EACNO,YACE,2FAXwB,SAaY/G,OA3HRgH,EA4HLJ,EAAKK,GA5HD,UAHP,6BAGO,kBACDD,EADC,eA6H7B,CACEE,OAAQ,OACRf,QAAS,CACPC,cAAc,UAAD,OAAYM,GACzB,eAAgB,oBAElBS,KAAMC,KAAKC,UAAUR,KAEvBF,MAAK,SAAC1G,GAAD,OAAcA,EAASC,UAvBF,cAatBoH,EAbsB,OAwBtBC,EAAYC,kBAAQf,EAAUrG,KAAI,SAACqH,GAAD,uBAAOA,EAAEC,oBAAT,aAAO,EAAgBC,QAxBnC,UAyBtB3H,OArI6B4H,EAqIKN,EAASL,GArIf,UALV,6BAKU,sBACAW,EADA,YAqIoB,CACpDV,OAAQ,OACRf,QAAS,CACPC,cAAc,UAAD,OAAYM,GACzB,eAAgB,oBAElBS,KAAMC,KAAKC,UAAU,CAAEQ,KAAMN,MA/BH,iCAiCrBD,EAASQ,cAAcC,SAjCF,kCA5GM,IAACH,EAFHZ,IA8GJ,OAAH,0D,8FC7G3B,IAoCMgB,EAAiB,SAACvE,GAAD,OACrB,oCACGA,EAAMwE,mBAAmB7H,KAAI,SAAC8H,GAAD,OAC5B,kBAACC,EAAD,CAAQC,IAAKF,EAAczF,KAAK4F,kBAC9B,4BAAKH,EAAczF,KAAK4F,kBACvBH,EAAcxF,UACb,2BACGwF,EAAcxF,UAAUhC,MAD3B,OACsCwH,EAAcxF,UAAU/B,QAE5DuH,EAAcvF,SAAW9C,EAAa+C,aACxC,mEAEA,mGAOJuF,EAASjF,IAAOK,IAAV,KAIG+E,EA3DF,WAAO,IAAD,EACuBtH,mBAAsB,MAD7C,mBACV0C,EADU,KACI6E,EADJ,OAEmBxH,IAA5BE,EAFS,EAETA,UAAWE,EAFF,EAEEA,aACb8G,EACS,MAAbhH,GAAqC,MAAhByC,EACjBlC,EAAuBkC,EAAczC,GACrC,KAEN,OACE,kBAAC,EAAD,KACmB,MAAhBE,EACC,kBAACqD,EAAD,KACE,+DACA,2BAAIrD,IAGN,oCACE,kBAAC,EAAD,CACEkD,SAAuB,MAAbpD,EACVsD,aAAcgE,IAEfN,GAAsBvE,GACrB,kBAACc,EAAD,KACE,uBAAGK,KAAMG,EAAetB,EAAa8E,gBAArC,sGAIA,kBAAC,EAAD,CAAgBP,mBAAoBA,Q,0OCtB3C,IAAMQ,EAAoB,SAAChF,GAAkB,IAAD,EACTzC,mBAAS,IAAI2C,KAAKF,EAAMwB,QADf,mBAC1CvB,EAD0C,KAC5B6E,EAD4B,OAEbxH,IAA5BE,EAFyC,EAEzCA,UAAWE,EAF8B,EAE9BA,aAF8B,EFiDrB,SAC5BF,EACAyC,EACAgD,GACI,IAAD,EACmC1F,mBAE5B,MAHP,mBACI0H,EADJ,KACiBC,EADjB,OAIqC3H,mBAAwB,MAJ7D,mBAIIG,EAJJ,KAIkBC,EAJlB,KAuCH,OAjCAC,qBAAU,WACR,GAAiB,MAAbJ,EAAJ,CAGA,IAAMgH,EAAqBzG,EAAuBkC,EAAczC,IACjD,uCAAG,8BAAAlB,EAAA,sEAER6I,EAEDX,EAAmB7H,IAAnB,uCAAuB,WAAO8H,GAAP,eAAAnI,EAAA,yDACK,MAA3BmI,EAAcxF,UADQ,yCAEjBmG,QAAQC,QAAQ,CACrB3G,SAAU+F,EACVR,aAAc,QAJQ,uBAONlC,EAClB0C,EAAcxF,UAAUhC,MACxBwH,EAAcxF,UAAU/B,OACxB+F,GAVwB,cAOpBqC,EAPoB,yBAYnB,CAAE5G,SAAU+F,EAAeR,aAAcqB,IAZtB,2CAAvB,uDAJS,SAkBKF,QAAQG,IAAIJ,GAlBjB,OAkBRtH,EAlBQ,OAmBdqH,EAAerH,GAnBD,gDAqBdF,EAAgB,oDAAD,OACuC,KAAM6H,QAD7C,MArBD,yDAAH,qDA0Bf1H,MACC,CAACN,EAAWyC,EAAcgD,IACtB,CAAEgC,cAAavH,gBEzFmC+H,CACvDjI,EACAyC,EACAD,EAAMgC,aAHDiD,EAH0C,EAG1CA,YAA2BS,EAHe,EAG7BhI,aAWpB,OANoB,MAAhBA,GACFsC,EAAM2F,QAAQjI,GAAc,GAEH,MAAvBgI,GACF1F,EAAM2F,QAAQD,GAAqB,GAGnC,kBAAC3E,EAAD,KACE,kEACA,kBAAC,EAAD,CACEd,aAAcA,EACdW,SAAuB,MAAbpD,EACVsD,aAAcgE,IAEA,MAAfG,EACC,2DAEA,kBAAC,EAAD,CACEW,WAAYX,EACZjH,aAAciC,EACdgD,MAAOjD,EAAMgC,gBAOjB6D,EAAmB,SAAC7F,GAAD,OAKvB,kBAACe,EAAD,KACE,kBAAC,GAAD,CACE6E,WAAY5F,EAAM4F,WAClB5H,aAAcgC,EAAMhC,aACpBiF,MAAOjD,EAAMiD,QAEf,kBAAC,GAAD,CAAW2C,WAAY5F,EAAM4F,eAI3BE,GAAwB,SAAC9F,GAIxB,IAAD,EAC0BzC,oBAAS,GADnC,mBACGwI,EADH,KACYC,EADZ,OAEkCzI,mBAAwB,MAF1D,mBAEG0I,EAFH,KAEgBC,EAFhB,KAGJtI,qBAAU,kBAAMsI,EAAe,QAAO,CAAClG,EAAMhC,eAC7C,IAAMmI,EAAgB,uCAAG,4BAAA7J,EAAA,6DACvB0J,GAAW,GADY,SAELlD,EAAe,sBAAD,OACR9C,EAAMhC,aAAaoI,qBADX,KAE9BpG,EAAM4F,WACN5F,EAAMiD,OALe,OAEjBoD,EAFiB,OAOvBL,GAAW,GACXE,EAAeG,GARQ,2CAAH,qDAUtB,OACE,6BACGN,EACC,8DACGE,EAGH,uBAAG7E,KAAM6E,GAAT,8CAFA,4BAAQpF,QAASsF,GAAjB,gCAQFzB,GAASjF,IAAOK,IAAV,KAINwG,GAAY,SAACtG,GAAD,OAChB,6BACGA,EAAM4F,WAAWjJ,KAAI,SAAC8H,GAAD,OACpB,kBAAC,GAAD,CAAQE,IAAKF,EAAc/F,SAASM,KAAK4F,kBACvC,4BAAKH,EAAc/F,SAASM,KAAK4F,kBAChCH,EAAc/F,SAASO,UACtBwF,EAAcR,aACZ,kBAAC,GAAD,CAAqBqB,MAAOb,EAAcR,eAE1C,kBAAC,GAAD,CAAmBqB,MAAOb,EAAc/F,SAASO,YAEjDwF,EAAc/F,SAASQ,SAAW9C,EAAa+C,aACjD,mEAEA,mGAOJoH,GAAsB,SAACvG,GAAD,aAC1B,kBAACwG,GAAD,KACE,yBACEC,IAAG,UAAEzG,EAAMsF,MAAMoB,MAAMC,OAAOC,MAAK,SAACC,GAAD,OAAwB,KAAfA,EAAIC,iBAA7C,aAAE,EAA2DT,IAChEU,IAAG,UAAK/G,EAAMsF,MAAMoB,MAAMrD,KAAvB,YAEL,2BACGrD,EAAMsF,MAAMjC,KACb,6BACCrD,EAAMsF,MAAM0B,QAAQrK,KAAI,SAACO,GAAD,OAAYA,EAAOmG,QAAM4D,KAAK,SAKvDT,GAAmB/G,IAAOK,IAAV,KAMhBoH,GAAoB,SAAClH,GAAD,OACxB,6CACkBA,EAAMsF,MAAMrI,MAD9B,OACyC+C,EAAMsF,MAAMpI,OADrD,gBCrGIiK,GAAe,SAACnH,GAAD,OAInB,kBAACe,EAAD,KACE,+DACCf,EAAMoH,MAAMC,oBACX,oCACE,mFACA,uBACEjG,KAAMG,EACJvB,EAAMwB,MAAQxB,EAAMwB,OAAQ,IAAItB,MAAO6E,gBAF3C,wBASJ,2BAAI/E,EAAMoH,MAAM5B,SAChB,sDAC2B,IACzB,uBAAGpE,KAAK,mCAAR,eAFF,OAOEkG,GAAmB,SACvBC,GAEA,IAAMC,EAAY,IAAInF,gBAAgBkF,EAASE,MAAM,IAC/CC,EAAaF,EAAUG,IAAI,SAC3BC,EAAaJ,EAAUG,IAAI,SAC3BE,EAAaL,EAAUG,IAAI,gBAEjC,OAAkB,MAAdC,EACK,CACLR,MAAM,gDAAD,OAAkDQ,EAAlD,KACLpG,MAAOkG,GAGO,MAAdA,GAAoC,MAAdG,EACjB,CACLT,MAAO,0DACP5F,MAAO,MAGJ,CACLQ,YAAa6F,EACbrG,MAAOkG,IAcLI,GAAgB,SACpBC,GADoB,MAEc,UAAWA,GAEhCC,GAxGS,WAAO,IAAD,EACFzK,mBAAgC,MAD9B,mBACrB6J,EADqB,KACda,EADc,KAEtBT,EAAYF,GAAiBY,cAAcX,UACjD,OAAIO,GAAcN,GAEd,kBAAC,EAAD,KACE,kBAAC,GAAD,CACEJ,MAAO,CACL5B,QAASgC,EAAUJ,MACnBC,oBAAoB,GAEtB7F,MAAOgG,EAAUhG,QAChB,KAKP,kBAAC,EAAD,KACG4F,EACC,kBAAC,GAAD,CAAcA,MAAOA,EAAO5F,MAAOgG,EAAUhG,QAE7C,kBAAC,EAAD,CACEQ,YAAawF,EAAUxF,YACvBR,MAAOgG,EAAUhG,MACjBmE,QAAS,SAACH,EAAS2C,GAAV,OACPF,EAAS,CAAEzC,QAASA,EAAS6B,mBAAoBc,SCZ9CC,GAbH,kBACV,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOC,KAAK,kBACV,kBAAC,GAAD,OAEF,kBAAC,IAAD,CAAOA,KAAK,KACV,kBAAC,EAAD,UCDYC,QACW,cAA7B5G,OAAOC,SAAS4G,UAEe,UAA7B7G,OAAOC,SAAS4G,UAEhB7G,OAAOC,SAAS4G,SAASC,MACvB,2DCZNC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,GAAD,OAEFC,SAASC,eAAe,SDiIpB,kBAAmBC,WACrBA,UAAUC,cAAcC,MACrB9F,MAAK,SAAA+F,GACJA,EAAaC,gBAEdC,OAAM,SAAA/B,GACLgC,QAAQhC,MAAMA,EAAM5B,a","file":"static/js/main.c8b12a9b.chunk.js","sourcesContent":["import { findLast } from \"lodash\";\nimport { DateTime, Interval } from \"luxon\";\nimport { useState, useEffect } from \"react\";\n\nconst JsonBinUrl = \"https://api.jsonbin.io/b/5ecfe1657741ef56a5638007/latest\";\n\ntype IncomingChartEntry = {\n  first_week_ending_date: string;\n  title: string;\n  artist: string;\n  weeks_at_number_one: string;\n};\n\nexport interface ChartEntry {\n  firstWeekEndDate: DateTime;\n  title: string;\n  artist: string;\n  weeksAtNumberOne: number;\n}\n\nexport type ChartData = Array<ChartEntry>;\n\nexport const getChartData: () => Promise<ChartData> = async () => {\n  const response = await fetch(JsonBinUrl);\n  const incomingEntries = await response.json();\n  return incomingEntries.map((entry: IncomingChartEntry) => ({\n    firstWeekEndDate: DateTime.fromISO(entry.first_week_ending_date),\n    title: entry.title,\n    artist: entry.artist,\n    weeksAtNumberOne: Number(entry.weeks_at_number_one),\n  }));\n};\n\nexport const useChartData = () => {\n  const [chartData, setChartData] = useState<ChartData | null>(null);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const data = await getChartData();\n        setChartData(data);\n      } catch (error) {\n        setErrorMessage(`Failed to load chart data from API`)\n      }\n    };\n    fetchData();\n  }, []);\n  return {chartData, errorMessage};\n};\n\nexport type BirthdayNumberOnes = Array<Birthday>;\n\nexport type Birthday = {\n  date: DateTime;\n  numberOne: ChartEntry | null;\n  reason: NoDataReason | null;\n};\n\nexport enum NoDataReason {\n  NO_DATA_YET,\n  DATE_TOO_OLD,\n}\n\nexport const findBirthdayNumberOnes = (\n  birthdayDate: Date,\n  chartData: ChartData\n): BirthdayNumberOnes =>\n  Interval.fromDateTimes(DateTime.fromJSDate(birthdayDate), DateTime.local())\n    .splitBy({ years: 1 })\n    .map((interval) => findBirthdayNumberOne(interval.start, chartData));\n\nexport const findBirthdayNumberOne = (\n  birthday: DateTime,\n  chartData: ChartData\n): Birthday => {\n  const chartEntryBeforeBirthday = findLast(\n    chartData,\n    (entry) => entry.firstWeekEndDate.minus({ days: 6 }) <= birthday // Date is last day of first week, so subtract 6 days to get beginning\n  );\n  if (chartEntryBeforeBirthday === undefined) {\n    return {\n      date: birthday,\n      numberOne: null,\n      reason: NoDataReason.DATE_TOO_OLD,\n    };\n  } else if (\n    // if entry is final entry\n    chartEntryBeforeBirthday === chartData[chartData.length - 1] &&\n    // and birthday is past chart start plus weeks at number one\n    birthday >=\n      chartEntryBeforeBirthday.firstWeekEndDate.plus({\n        weeks: chartEntryBeforeBirthday.weeksAtNumberOne,\n        days: -6,\n      })\n  ) {\n    return {\n      date: birthday,\n      numberOne: null,\n      reason: NoDataReason.NO_DATA_YET,\n    };\n  } else {\n    return {\n      date: birthday,\n      numberOne: chartEntryBeforeBirthday,\n      reason: null,\n    };\n  }\n};\n","import React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport DatePicker from \"react-datepicker\";\n\ntype Props = {\n  disabled: boolean;\n  onDateSelect: (date: Date) => void;\n  selectedDate?: Date;\n};\n\nconst BirthdayPicker = (props: Props) => {\n  const [birthdayDate, setBirthdayDate] = useState(\n    props.selectedDate ? props.selectedDate : new Date()\n  );\n\n  return (\n    <Container>\n      <h3>Enter your birthday below:</h3>\n      <CenteredDatePicker\n        selected={birthdayDate}\n        onChange={(date) =>\n          date ? setBirthdayDate(date) : setBirthdayDate(new Date())\n        }\n        dateFormat=\"dd/MM/yyyy\"\n        minDate={new Date(1900, 0, 1)}\n        maxDate={new Date()}\n        showMonthDropdown\n        showYearDropdown\n        dropdownMode=\"select\"\n      />\n      <SubmitButton\n        disabled={props.disabled}\n        onClick={() => props.onDateSelect(birthdayDate)}\n      >\n        Find me a playlist\n      </SubmitButton>\n    </Container>\n  );\n};\n\nconst CenteredDatePicker = styled(DatePicker)`\n  text-align: center;\n`\n\nconst SubmitButton = styled.button`\n  margin: 10px;\n`;\n\nconst Container = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding: 20px;\n`;\n\nexport default BirthdayPicker;\n","import React, { FunctionComponent } from \"react\";\nimport styled from \"styled-components\";\n\nconst MainLayout: FunctionComponent = (props) => (\n  <PaddedCenteredContainer>\n    <h1>Birthday Playlist Generator</h1>\n    <p>\n      Generate a Spotify playlist of UK number ones on your Birthday since you\n      were born. This site is a work in progress.\n    </p>\n    <p>\n      Historical data is consistent with{\" \"}\n      <a href=\"https://en.wikipedia.org/wiki/Lists_of_UK_Singles_Chart_number_ones\">\n        this Wikipedia page\n      </a>{\" \"}\n      (as of 9th June 2020), and new entries will be updated on day of chart\n      release.\n    </p>\n    <MainContent>{props.children}</MainContent>\n    <Footer />\n  </PaddedCenteredContainer>\n);\n\nexport const CenteredContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nexport const PaddedCenteredContainer = styled(CenteredContainer)`\n  padding: 20px;\n`;\n\nconst MainContent = styled(CenteredContainer)`\n  flex-grow: 1;\n`;\n\nconst FooterContainer = styled.div`\n  text-align: center;\n  width: 80%;\n`;\n\nconst Footer = () => (\n  <FooterContainer>\n    <hr />\n    <p>\n      Â© 2020 <a href=\"https://mattmarch.co.uk\">Matt March</a>\n    </p>\n    <p>\n      Check out this project on{\" \"}\n      <a href=\"https://github.com/mattmarch/BirthdayPlaylist\">Github</a>\n    </p>\n  </FooterContainer>\n);\n\nexport default MainLayout;\n","import { useEffect, useState } from \"react\";\nimport { Birthday, ChartData, findBirthdayNumberOnes } from \"./ChartData\";\nimport { compact } from \"lodash\";\n\nexport const SpotifyAuthUrl = (state: string) => {\n  const callbackUrl = window.location.origin;\n  return `https://accounts.spotify.com/authorize?client_id=6c0a042391fa42e8ac96a5eed4306dfe&redirect_uri=${callbackUrl}&scope=playlist-modify-public&response_type=token&state=${state}`;\n};\n\nconst SpotifyApiBaseUrl = \"https://api.spotify.com/v1\";\nconst SpotifySearchUrl = `${SpotifyApiBaseUrl}/search`;\nconst SpotifyProfileUrl = `${SpotifyApiBaseUrl}/me`;\nconst SpotifyPlaylistCreateUrl = (userId: string) =>\n  `${SpotifyApiBaseUrl}/users/${userId}/playlists`;\nconst SpotifyPlaylistAddTracksUrl = (playlistId: string) =>\n  `${SpotifyApiBaseUrl}/playlists/${playlistId}/tracks`;\n\nexport type SpotifyTrack = {\n  album: SpotifyAlbum;\n  artists: Array<SpotifyArtist>;\n  id: string;\n  name: string;\n  uri: string;\n};\n\ntype SpotifyAlbum = {\n  name: string;\n  images: Array<SpotifyAlbumImage>;\n};\n\ntype SpotifyAlbumImage = {\n  height: number;\n  Width: number;\n  url: string;\n};\n\ntype SpotifyArtist = {\n  name: string;\n};\n\nexport type BirthdayWithSpotifyData = {\n  birthday: Birthday;\n  spotifyTrack: SpotifyTrack | null;\n};\n\nconst searchTrack = async (\n  title: string,\n  artist: string,\n  accessToken: string\n): Promise<SpotifyTrack | null> => {\n  const firstArtist = artist.split(/ FT. | FEATURING | WITH THE |\\/| & /)[0];\n  const firstTrack = title.split(\"/\")[0];\n  const queryParameters = new URLSearchParams({\n    q: `\"${firstTrack}\" \"${firstArtist}\"`,\n    type: \"track\",\n    limit: \"1\",\n  });\n  const response = await fetch(\n    `${SpotifySearchUrl}?${queryParameters.toString()}`,\n    {\n      headers: { Authorization: `Bearer ${accessToken}` },\n    }\n  );\n  const json = await response.json();\n  return json.tracks.items.length > 0 ? json.tracks.items[0] : null;\n};\n\nexport const useSpotifyData = (\n  chartData: ChartData | null,\n  selectedDate: Date,\n  token: string\n) => {\n  const [spotifyData, setSpotifyData] = useState<Array<\n    BirthdayWithSpotifyData\n  > | null>(null);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (chartData == null) {\n      return;\n    }\n    const birthdayNumberOnes = findBirthdayNumberOnes(selectedDate, chartData);\n    const fetchData = async () => {\n      try {\n        const entries: Array<Promise<\n          BirthdayWithSpotifyData\n        >> = birthdayNumberOnes.map(async (birthdayEntry) => {\n          if (birthdayEntry.numberOne == null) {\n            return Promise.resolve({\n              birthday: birthdayEntry,\n              spotifyTrack: null,\n            });\n          }\n          const track = await searchTrack(\n            birthdayEntry.numberOne.title,\n            birthdayEntry.numberOne.artist,\n            token\n          );\n          return { birthday: birthdayEntry, spotifyTrack: track };\n        });\n        const data = await Promise.all(entries);\n        setSpotifyData(data);\n      } catch (error) {\n        setErrorMessage(\n          `Error retrieving data from spotify, message was \"${error.message}\"`\n        );\n      }\n    };\n    fetchData();\n  }, [chartData, selectedDate, token]);\n  return { spotifyData, errorMessage };\n};\n\ntype SpotifyUser = {\n  id: string;\n};\n\ntype SpotifyPlaylist = {\n  id: string;\n  external_urls: { spotify: string };\n};\n\nexport const createPlaylist = async (\n  playlistName: string,\n  birthdays: Array<BirthdayWithSpotifyData>,\n  token: string\n) => {\n  const user: SpotifyUser = await fetch(SpotifyProfileUrl, {\n    headers: { Authorization: `Bearer ${token}` },\n  }).then((response) => response.json());\n  const playlistDetails = {\n    name: playlistName,\n    description:\n      \"Playlist of Birthday UK Number One singles created via https://playlist.mattmarch.co.uk\",\n  };\n  const playlist: SpotifyPlaylist = await fetch(\n    SpotifyPlaylistCreateUrl(user.id),\n    {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${token}`,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(playlistDetails),\n    }\n  ).then((response) => response.json());\n  const trackUris = compact(birthdays.map((b) => b.spotifyTrack?.uri));\n  await fetch(SpotifyPlaylistAddTracksUrl(playlist.id), {\n    method: \"POST\",\n    headers: {\n      Authorization: `Bearer ${token}`,\n      \"Content-Type\": \"application/json\",\n    },\n    body: JSON.stringify({ uris: trackUris }),\n  });\n  return playlist.external_urls.spotify;\n};\n","import React, { useState } from \"react\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport styled from \"styled-components\";\nimport {\n  BirthdayNumberOnes,\n  findBirthdayNumberOnes,\n  NoDataReason,\n  useChartData,\n} from \"./ChartData\";\nimport BirthdayPicker from \"./shared/BirthdayPicker\";\nimport MainLayout, { CenteredContainer } from \"./shared/MainLayout\";\nimport { SpotifyAuthUrl } from \"./Spotify\";\n\nconst Home = () => {\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const { chartData, errorMessage } = useChartData();\n  const birthdayNumberOnes =\n    chartData != null && selectedDate != null\n      ? findBirthdayNumberOnes(selectedDate, chartData)\n      : null;\n\n  return (\n    <MainLayout>\n      {errorMessage != null ? (\n        <CenteredContainer>\n          <h3>Sorry! Something went wrong! :(</h3>\n          <p>{errorMessage}</p>\n        </CenteredContainer>\n      ) : (\n        <>\n          <BirthdayPicker\n            disabled={chartData == null}\n            onDateSelect={setSelectedDate}\n          />\n          {birthdayNumberOnes && selectedDate && (\n            <CenteredContainer>\n              <a href={SpotifyAuthUrl(selectedDate.toISOString())}>\n                Connect with Spotify for more track information and the option\n                to automatically create a playlist.\n              </a>\n              <NumberOnesList birthdayNumberOnes={birthdayNumberOnes} />\n            </CenteredContainer>\n          )}\n        </>\n      )}\n    </MainLayout>\n  );\n};\n\nconst NumberOnesList = (props: { birthdayNumberOnes: BirthdayNumberOnes }) => (\n  <>\n    {props.birthdayNumberOnes.map((birthdayEntry) => (\n      <Result key={birthdayEntry.date.toLocaleString()}>\n        <h4>{birthdayEntry.date.toLocaleString()}</h4>\n        {birthdayEntry.numberOne ? (\n          <p>\n            {birthdayEntry.numberOne.title} by {birthdayEntry.numberOne.artist}\n          </p>\n        ) : birthdayEntry.reason === NoDataReason.DATE_TOO_OLD ? (\n          <p>UK Charts only started on 08/11/1952</p>\n        ) : (\n          <p>The latest chart data hasn't been updated yet, try again soon!</p>\n        )}\n      </Result>\n    ))}\n  </>\n);\n\nconst Result = styled.div`\n  text-align: center;\n`;\n\nexport default Home;\n","import React, { useState, useEffect } from \"react\";\nimport { useChartData, NoDataReason, ChartEntry } from \"./ChartData\";\nimport {\n  useSpotifyData,\n  BirthdayWithSpotifyData,\n  createPlaylist,\n  SpotifyTrack,\n} from \"./Spotify\";\nimport { CenteredContainer } from \"./shared/MainLayout\";\nimport BirthdayPicker from \"./shared/BirthdayPicker\";\nimport styled from \"styled-components\";\n\ntype Props = {\n  accessToken: string;\n  state: string;\n  onError: (message: string, isSpotifyError: boolean) => void;\n};\n\nexport const NumberOnesDisplay = (props: Props) => {\n  const [selectedDate, setSelectedDate] = useState(new Date(props.state));\n  const { chartData, errorMessage } = useChartData();\n  const {spotifyData, errorMessage: spotifyErrorMessage} = useSpotifyData(\n    chartData,\n    selectedDate,\n    props.accessToken\n  );\n  if (errorMessage != null) {\n    props.onError(errorMessage, false)\n  }\n  if (spotifyErrorMessage != null) {\n    props.onError(spotifyErrorMessage, true)\n  }\n  return (\n    <CenteredContainer>\n      <p>You are now logged in with Spotify.</p>\n      <BirthdayPicker\n        selectedDate={selectedDate}\n        disabled={chartData == null}\n        onDateSelect={setSelectedDate}\n      />\n      {spotifyData == null ? (\n        <p>Loading data from Spotify...</p>\n      ) : (\n        <SpotifyTrackData\n          numberOnes={spotifyData}\n          birthdayDate={selectedDate}\n          token={props.accessToken}\n        />\n      )}\n    </CenteredContainer>\n  );\n};\n\nconst SpotifyTrackData = (props: {\n  numberOnes: Array<BirthdayWithSpotifyData>;\n  birthdayDate: Date;\n  token: string;\n}) => (\n  <CenteredContainer>\n    <CreatePlaylistDisplay\n      numberOnes={props.numberOnes}\n      birthdayDate={props.birthdayDate}\n      token={props.token}\n    />\n    <TrackList numberOnes={props.numberOnes} />\n  </CenteredContainer>\n);\n\nconst CreatePlaylistDisplay = (props: {\n  numberOnes: Array<BirthdayWithSpotifyData>;\n  birthdayDate: Date;\n  token: string;\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [playlistUrl, setPlaylistUrl] = useState<string | null>(null);\n  useEffect(() => setPlaylistUrl(null), [props.birthdayDate]);\n  const onCreatePlaylist = async () => {\n    setLoading(true);\n    const url = await createPlaylist(\n      `Birthday Playlist (${props.birthdayDate.toLocaleDateString()})`,\n      props.numberOnes,\n      props.token\n    );\n    setLoading(false);\n    setPlaylistUrl(url);\n  };\n  return (\n    <div>\n      {loading ? (\n        <p>Creating playlist on Spotify...</p>\n      ) : !playlistUrl ? (\n        <button onClick={onCreatePlaylist}>Create playlist on Spotify</button>\n      ) : (\n        <a href={playlistUrl}>Checkout your Birthday Playlist on Spotify</a>\n      )}\n    </div>\n  );\n};\n\nconst Result = styled.div`\n  text-align: center;\n`;\n\nconst TrackList = (props: { numberOnes: Array<BirthdayWithSpotifyData> }) => (\n  <div>\n    {props.numberOnes.map((birthdayEntry) => (\n      <Result key={birthdayEntry.birthday.date.toLocaleString()}>\n        <h4>{birthdayEntry.birthday.date.toLocaleString()}</h4>\n        {birthdayEntry.birthday.numberOne ? (\n          birthdayEntry.spotifyTrack ? (\n            <TrackSpotifyDetails track={birthdayEntry.spotifyTrack} />\n          ) : (\n            <CouldNotFindTrack track={birthdayEntry.birthday.numberOne} />\n          )\n        ) : birthdayEntry.birthday.reason === NoDataReason.DATE_TOO_OLD ? (\n          <p>UK Charts only started on 08/11/1952</p>\n        ) : (\n          <p>The latest chart data hasn't been updated yet, try again soon!</p>\n        )}\n      </Result>\n    ))}\n  </div>\n);\n\nconst TrackSpotifyDetails = (props: { track: SpotifyTrack }) => (\n  <SpotifyTrackInfo>\n    <img\n      src={props.track.album.images.find((img) => img.height === 64)?.url}\n      alt={`${props.track.album.name} cover`}\n    />\n    <p>\n      {props.track.name}\n      <br />\n      {props.track.artists.map((artist) => artist.name).join(\", \")}\n    </p>\n  </SpotifyTrackInfo>\n);\n\nconst SpotifyTrackInfo = styled.div`\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst CouldNotFindTrack = (props: { track: ChartEntry }) => (\n  <p>\n    Could not find {props.track.title} by {props.track.artist} on Spotify\n  </p>\n);\n","import React, { useState } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport MainLayout, { CenteredContainer } from \"./shared/MainLayout\";\nimport { SpotifyAuthUrl } from \"./Spotify\";\nimport { NumberOnesDisplay } from \"./SpotifyTrackList\";\n\nconst SpotifyLoggedIn = () => {\n  const [error, setError] = useState<ErrorToDisplay | null>(null);\n  const urlParams = getUrlHashParams(useLocation().pathname);\n  if (isErrorParams(urlParams)) {\n    return (\n      <MainLayout>\n        <ErrorDisplay\n          error={{\n            message: urlParams.error,\n            isSpotifyAuthError: true,\n          }}\n          state={urlParams.state}\n        />{\" \"}\n      </MainLayout>\n    );\n  }\n  return (\n    <MainLayout>\n      {error ? (\n        <ErrorDisplay error={error} state={urlParams.state} />\n      ) : (\n        <NumberOnesDisplay\n          accessToken={urlParams.accessToken}\n          state={urlParams.state}\n          onError={(message, isSpotifyError) =>\n            setError({ message: message, isSpotifyAuthError: isSpotifyError })\n          }\n        />\n      )}\n    </MainLayout>\n  );\n};\n\ntype ErrorToDisplay = {\n  message: string;\n  isSpotifyAuthError: boolean;\n};\n\nconst ErrorDisplay = (props: {\n  error: ErrorToDisplay;\n  state: string | null;\n}) => (\n  <CenteredContainer>\n    <h3>Sorry! Something went wrong! :(</h3>\n    {props.error.isSpotifyAuthError && (\n      <>\n        <p>An error occurred during communication with spotify.</p>\n        <a\n          href={SpotifyAuthUrl(\n            props.state ? props.state : new Date().toISOString()\n          )}\n        >\n          Click to try again.\n        </a>\n      </>\n    )}\n    <p>{props.error.message}</p>\n    <p>\n      If this problem persists{\" \"}\n      <a href=\"mailto:playlist@mattmarch.co.uk\">let me know</a>.\n    </p>\n  </CenteredContainer>\n);\n\nconst getUrlHashParams = (\n  pathname: string\n): SuccessCallbackParams | ErrorCallbackParams => {\n  const urlParams = new URLSearchParams(pathname.slice(1));\n  const stateParam = urlParams.get(\"state\");\n  const errorParam = urlParams.get(\"error\");\n  const tokenParam = urlParams.get(\"access_token\");\n\n  if (errorParam != null) {\n    return {\n      error: `Error authorizing with Spotify. Message was \"${errorParam}\"`,\n      state: stateParam,\n    };\n  }\n  if (stateParam == null || tokenParam == null) {\n    return {\n      error: \"Callback from Spotify was missing key return parameters\",\n      state: null,\n    };\n  }\n  return {\n    accessToken: tokenParam,\n    state: stateParam,\n  };\n};\n\ninterface SuccessCallbackParams {\n  accessToken: string;\n  state: string;\n}\n\ninterface ErrorCallbackParams {\n  error: string;\n  state: string | null;\n}\n\nconst isErrorParams = (\n  params: SuccessCallbackParams | ErrorCallbackParams\n): params is ErrorCallbackParams => \"error\" in params;\n\nexport default SpotifyLoggedIn;\n","import React from \"react\";\nimport \"react-datepicker/dist/react-datepicker.css\";\nimport { HashRouter, Route, Switch } from \"react-router-dom\";\nimport Home from \"./Home\";\nimport SpotifyLoggedIn from \"./SpotifyLoggedIn\";\n\nconst App = () => (\n  <HashRouter>\n    <Switch>\n      <Route path=\"/:access_token\">\n        <SpotifyLoggedIn />\n      </Route>\n      <Route path=\"/\">\n        <Home />\n      </Route>\n    </Switch>\n  </HashRouter>\n);\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}